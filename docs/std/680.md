###### #std680

# Поддержка толстого клиента, управляемое приложение, клиент-сервер

###### 1.

В управляемом режиме иногда требуется поддержка запуска толстого клиента (режим управляемого приложения).
Причина — часть возможностей, которые есть в обычном приложении, но отсутствуют в управляемом.
Подробнее: [#metod3266: Функциональность обычного приложения, отсутствующая в управляемом приложении](../metod8dev/3266.md).

###### 2.

В конфигурациях для управляемого приложения обычно предполагается, что в клиент-серверном режиме код модулей:

- менеджера;
- объекта;
- сеанса;

компилируется и выполняется только на сервере.

В этих модулях часто есть обращения к общим модулям, доступным только на сервере.

Однако в толстом клиенте (управляемое приложение, клиент-сервер) эти модули могут компилироваться и выполняться на клиенте.
Например:

- при явном создании объекта в клиентском коде;
- при неявных вызовах платформой обработчиков модулей менеджера и модуля сеанса на клиенте.

Из-за этого возникают ошибки и лишние сообщения проверки конфигурации.

Чтобы исключить незапланированную компиляцию и выполнение на клиенте:

- в модулях объектов полностью исключайте клиентский контекст инструкцией препроцессора;
- в модуле сеанса полностью исключайте клиентский контекст инструкцией препроцессора;
- в модулях менеджеров всех объектов метаданных полностью исключайте клиентский контекст инструкцией препроцессора.

!!! success "Пример для модуля объекта"

    ```bsl
    #Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда
        ...
    #Иначе
        ВызватьИсключение НСтр("ru = 'Недопустимый вызов объекта на клиенте.'");
    #КонецЕсли
    ```

!!! success "Пример для модуля сеанса"

    ```bsl
    #Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда
        ...
    #КонецЕсли
    ```

!!! success "Пример для модуля менеджера"

    ```bsl
    #Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда
        ...
    #КонецЕсли
    ```

Если в модуле менеджера формируется представление через обработчики `#!bsl ОбработкаПолученияПредставления` и `#!bsl ОбработкаПолученияПолейПредставления`, то в толстом клиенте (управляемое приложение, клиент-сервер) представление будет формироваться по умолчанию, без вызова этих обработчиков.

Обработчики `#!bsl ОбработкаПолученияДанныхВыбора` и `#!bsl ОбработкаПолученияФормы` вызываются только на сервере, и это ограничение на них не распространяется.

###### 3.

Если это ограничение нужно снять, обеспечьте работу на клиенте:

- обработчиков `#!bsl ОбработкаПолученияПредставления` и `#!bsl ОбработкаПолученияПолейПредставления`;
- кода подписок на эти события.

Для этого:

- вынесите код обработчиков за инструкции препроцессора из п. 2;
- разместите обработчики подписок в клиент-серверных модулях;
- при переходе на сервер используйте общие модули с признаком `Вызов сервера`;
- не передавайте мутабельные типы (`СправочникОбъект`, `ДокументОбъект` и т.п.) через параметры и возвращаемые значения.

Не устанавливайте признак `Вызов сервера` всем модулям с признаком `Сервер`.
См. [#std679: Ограничение на установку признака «Вызов сервера» у общих модулей](679.md).

!!! failure "Неправильно"

    ```bsl
    Процедура ОбработкаПолученияПредставления(Данные, Представление, СтандартнаяОбработка)

        Взаимодействия.ОбработкаПолученияПредставления(Данные, Представление);
        СтандартнаяОбработка = Ложь;

    КонецПроцедуры
    ```

!!! success "Правильно"

    ```bsl
    Процедура ОбработкаПолученияПредставления(Данные, Представление, СтандартнаяОбработка)

        ВзаимодействияВызовСервера.ОбработкаПолученияПредставления(Данные, Представление);
        СтандартнаяОбработка = Ложь;

    КонецПроцедуры
    ```

###### 4.

Для расстановки фрагментов кода с инструкциями препроцессора можно использовать [обработку с ИТС](https://its.1c.ru/db/files/1CITS/EXE/V8Std/%D0%90%D0%B2%D1%82%D0%BE%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%D0%9A%D0%BE%D0%B4%D0%B0%D0%98%D0%9B%D0%BE%D0%BA%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F/%D0%90%D0%B2%D1%82%D0%BE%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%D0%9A%D0%BE%D0%B4%D0%B0%D0%98%D0%9B%D0%BE%D0%BA%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F.zip).

###### См. также

- [#std469: Правила создания общих модулей](469.md)
- [#std679: Ограничение на установку признака «Вызов сервера» у общих модулей](679.md)
- [Обработчики событий получения представления объектов](https://its.1c.ru/db/v8std/content/746/hdoc)

###### Источник

https://its.1c.ru/db/v8std#content:680
