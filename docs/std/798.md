###### #std798

# Использование ботов системы взаимодействия

###### 1.

В конфигурации должно быть регламентное задание, которое вызывает `#!bsl СистемаВзаимодействия.ВыполнитьОбработкуБотов()`.
Метод имеет особенности:

- работает без учета разделителей;
- обращается к данным о регистрации системы взаимодействия в каждой области разделенной ИБ и к системной таблице экземпляров ботов этой области;
- при наличии регистрации и ботов запускает системный процесс с WebSocket-соединением;
- системный процесс запускается по одному на область, независимо от числа экземпляров ботов;
- предопределенные боты создаются при первом вызове `#!bsl ВыполнитьОбработкуБотов()`.

Для решений в модели сервиса ([Технология 1cFresh](https://v8.1c.ru/platforma/tekhnologiya-1cfresh/)) соблюдайте рекомендации ниже.

###### 1.1.

Не создавайте предопределенных ботов.
Предусмотрите настройки включения и отключения бота.
При включении создавайте бота программно, при отключении — удаляйте.

###### 1.2.

Регламентное задание, вызывающее `#!bsl ВыполнитьОбработкуБотов()`:

- должно быть одно, независимо от числа объектов метаданных `#!bsl БотСистемыВзаимодействия`;
- должно быть неразделенным (не входить в состав разделителей).

Несоблюдение требований приводит к лишней нагрузке на сервер 1С:Предприятие и сервер системы взаимодействия.

###### 2.

При создании бота указывайте пользователя системы взаимодействия, не связанного с пользователем информационной базы.
Иначе пользователь информационной базы не сможет работать с системой взаимодействия.

###### 3.

Если создаете несколько экземпляров ботов для одного объекта метаданных, связывайте их с разными пользователями системы взаимодействия.
Иначе будет работать только последний созданный экземпляр.

###### 4.

Обработчик сообщений ботов должен работать без необработанных исключений (см [#std499: Перехват исключений в коде](499.md)).
Сообщения сохраняются в системную очередь, затем для каждого вызывается `#!bsl ОбработкаСообщенияСистемыВзаимодействия`.
Сообщение удаляется из очереди только после успешной обработки.
Если при обработке возникает исключение, сообщение останется в очереди и будет обрабатываться повторно.
Это блокирует обработку следующих сообщений.

###### См. также

- [Документация разработчика: 29.4.6.3.4. Схема обработки сообщений от системы взаимодействия](https://its.1c.ru/db/v85doc/bookmark/dev/TI000002350)

###### Источник

https://its.1c.ru/db/v8std#content:798
